########################################################################
#                          TCL Game Service 
########################################################################

# Index
########################################################################

1. Description
2. Download
3. Installation
4. Configuration
5. Modules
6. Credits

# 1. Description
########################################################################

UnrealIRCD Service Framework is a framework who provide an easy way to
develop a service which link to an Unreal 3.2 network.
With a little configuration it can link an connect a bot on many chans
but he do nothing until it is completed by modules.

# 2. Download
########################################################################
    a. Latest stable version
    ------------------------
There is no stable version for the moment

    b. Latest live version
    ----------------------
Download live archive from
  https://github.com/dlgg/UnrealIRCD-Service-Framework/tarball/master
or you can use git :
  git clone git://github.com/dlgg/UnrealIRCD-Service-Framework.git


# 3. Installation 
########################################################################
- Extract it
- Rename folder
- Modify config.tcl
- Run it

You can add a crontab :
* * * * * /path/to/framework.sh start

# 4. Configuration
########################################################################
You will find below a list of variable which are safe to be changed.
Please avoid to modify other variable unless you know what you do or if
the developpers ask you to do it.

    a. General options
    ------------------
debug             0 for no debug / 1 (default) for debug informations
                  in log.

    b. General options
    ------------------
::irc::lang       Available for the moment : en fr.
::irc::pid        File where the pid should be wrote.

    c. Service configuration
    ------------------------
::irc::ip         IP address of your IRC hub for the connection of the
                  UnrealIRCD Framework Service.
::irc::port       Port of your irchub. This need to be a serverport.
::irc::password   Password specified un unrealircd.conf for the link.
::irc::numeric    Unique identifier on the network of the service.
::irc::servername Full DNS address of the service on the network.
::irc::netname    Name of your IRC Network. Please be careful, this is
                  case-sensitive and need to be the same on all the IRC
                  servers.
::irc::hub        Full DNS address of the hub where you connect the
                  UnrealIRCD Framework Service.
::irc::svcname    Name to use for the UnrealIRCD Framework. Tipically
                  the name of your project.
::irc::uversion   Version of unreal protocol to use.
                  2310 : Unreal 3.2.9
                  2309 : Unreal 3.2.6 3.2.7 3.2.8
                  2308 : Unreal 3.2.5
                  2307 : Unreal 3.2.4
                  2306 : Unreal 3.2.3
                  2305 : Unreal 3.2.2
                  2304 : Unreal 3.2.1
                  2303 : Unreal 3.2beta 3.2
                  2302 : Unreal 3.1.1 to 3.1.4
                  2301 : Unreal 3.1
                  2300 : Unreal 3.0 

    d. Master Bot Controller
    ------------------------
::irc::nick         Nickname of the main bot
::irc::username     Username of the main bot
::irc::hostname     Hostname of the main bot
::irc::realname     GECOS of the main bot
::irc::adminchan    Logchan for the services
::irc::chanlist     Lists of all chans where the main bot needs to be.
                    Don't add the modules chans. The bot will join it
                    automatically.
                    The masters bots addons will be active on all chans
                    by default unless they are coded for filtering the
                    chans.
::irc::root         Name of the main adminsitrator of the service. For
                    the moment this is the only one person who can use
                    the admin commands. Administrators of the service
                    will be add soon.
::irc::cmdchar      Character to use for prefixing the command. For not
                    confusing with other bots or hiding the commands.

    e. Modules
    ----------
::irc::toload       Lists of modules to load. This is the name of files
                    under the games directory whitout the extension.

    f. Partyline configuration
    --------------------------
::pl::ip            IP to listen for the partyline. By default listen on
                    all IP of the system (bind on 0.0.0.0)
::pl::port          Port to listen for the partyline. By default 45000
::pl::pass          Port to use for authentification on partyline. It is
                    the same for all admins for the moment until admins
                    code is done.

    g. Unreal link block
    --------------------
link tcl.hebeo.fr
{
        username        *;
        hostname        *;
        bind-ip         192.168.42.1;
        port            7029;
        hub             *;
        password-connect "tclpur";
        password-receive "tclpur";
        class           servers;
};

You also need to add the servername of UnrealIRCD Framework Service to
ulines block.

ulines
{
  services.hebeo.fr;
  tcl.hebeo.fr;
};


# 5. Modules
########################################################################
    a. Variables to use
    -------------------
You'll find below the variables that are not explain in the config part.

::irc::botlist            Keep list of virtual users declared on the
                          framework.
::irc::mychans            Keep list of chans where the bots of
                          framework are.
::irc::userlist           Keep list of all users on the network.
::irc::chanlist           Keep list of all the chans.
::irc::users($chan)       Keep list of users on a chan. 
::irc::users($servername) Keep list of users on a server.
::irc::regusers           Keep list of registered users.
::irc::srvname2num($numeric) Keep a map betweenn servernames and numeric
                             in decimal format.
::tools::ub64chars        Base64 map for unreal numeric NICK and SJOIN
::tools::ub64charsnickip  Base64 map for unreal NICKIP


    b. Specific Tools TCL proc
    --------------------------
All procs are in namespace ::tools so you need to prefix each of
followings procs by ::tools:: or export it in your namespace.

charfilter $arg
    Strip $arg for escaping dangerous characters

stripmirc $arg
   Strip $arg for removing mirc text modifier codes

test $string1 $string2
   Test if $string1 and $string2 are equals

testcs $string1 $string2
   Test if $string1 and $string2 are case-sensitive equals

unixtime
   Return the current timestamp in EPOCH format

lremove $list $element
   Return $list without $element

llreplace $list $oldelement $newelement
   Return $list with $oldelement replaced by $newelement

nodouble $list
   Return $list without having an element who appear two times

duration
   Return a time in seconds in "xx days xx hours xx minutes xx seconds"

rand $multiplier
   Return a random integer from 0 to $multiplier

dec2base/base2dec $num $baselist
   Transform from/to base $num using $baselist as map


    c. Specific IRC TCL proc
    ------------------------
All procs are in namespace ::irc so you need to prefix each of
followings procs by ::irc:: or export it in your namespace.

rehash
    Rehash the service

send $raw
    Send a raw message by service

bot_init $nick $username $hostname $gecos
    Connect a virtual bot with given nick, username, hostname and gecos

join_chan $bot $chan
    Make a virtual bot join a chan and being +ao

is_admin $nick
    Return TRUE if the given nick is admin on the service

is_chan $string
    Return TRUE if the given $string start with a #


    d. Hooks for developping modules
    --------------------------------
For register a hook use the proc ::irc::hook_register follow by the
signal you want to hook and the full name of your proc.
Hooks are done in front of events so before updating variables. Thinks
of this when you use ::irc:: variables.

join $nick $chan
    List of procs to call when $nick join a chan. This is a global hook
    who match on all chans of network

join-$chan $nick
    List of procs to call when $nick join the specific $chan.

part $nick $chan $reason
    List of procs to call when $nick part a chan. This is a global hook
    who match on all chans of network

part-chan $nick $reason
    List of procs to call when $nick part the specific $chan.

kick $kicker $chan $nick $reason
    List of procs to call when $nick is kicked by $kicker from a $chan
    for the $reason.
    This is a global hook who match on all chans of network

kick-chan $kicker $nick $reason
    List of procs to call when $nick is kicked by $kicker from the
    specific $chan.

quit $nick $reason
    List of procs to call when $nick quit with the reason $reason.

kill $nick $reason
    List of procs to call when $nick is kill with the reason $reason.

privmsgchan $nick $chan $text
    List of procs to call when a PRIVMSG is send to a $chan where a bot
    is.
    $text is send escaped for security

privmsg-#$chan $nick $text
    List of procs to call when a PRIVMSG is send to a specific $chan.
    $text is send escaped for security

privmsg-$bot $nick $text
    List of procs to call when a PRIVMSG is send to a specific $bot.
    $text is send escaped for security
    

    e. Specific IRC TCL proc
    ------------------------
All procs below are in namespace ::pl so you need to prefix each of
followings procs by ::pl:: or export it in your namespace.

send $sock $raw
    Send a raw message to a pl sock


# 6. Credits
########################################################################
TODO

